{% load static %}

<div class="report-page">
    <div class="page-content">
        <h2 class="chapter-title">5.4 扭轉向設計風力計算 (簡化法)</h2>

        <div class="report-content-block">
            <!-- 適用性檢核 -->
            <div class="summary-box" style="background-color: {% if chapter_9_data.check.is_applicable %}#e8f5e9{% else %}#ffebee{% endif %}; border-left: 5px solid {% if chapter_9_data.check.is_applicable %}#4caf50{% else %}#f44336{% endif %};">
                <p style="font-weight: bold; margin-bottom: 5px;">適用性檢核：</p>
                <ul style="margin: 0; padding-left: 20px; font-size: 0.9rem;">
                    <li>參數：$h/\sqrt{BL} = {{ chapter_9_data.check.h_sqrt_BL|floatformat:2 }}$</li>
                    <li>{{ chapter_9_data.check.message }}</li>
                </ul>
            </div>

            {% if chapter_9_data.check.is_applicable %}
                <div class="math-container" style="margin: 15px 0;">
                    <p><strong>1. 扭轉向風力計算公式 (規範 2.23)：</strong></p>
                    <p>$$ M_{Tz} = 0.28 (B W_{Dz})^* $$</p>
                    <p style="font-size: 0.9em; color: #666;">
                        註：$(B W_{Dz})^*$ 為各向來風高度 $z$ 處順風向風力 $W_{Dz}$ 與迎風面寬度 $B$ 乘積之較大值。
                        下表分別列出 X 向與 Y 向之計算結果。
                    </p>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th rowspan="2" style="vertical-align: middle;">高度範圍<br>(m)</th>
                            <th rowspan="2" style="vertical-align: middle;">高度 z<br>(m)</th>
                            <th colspan="3" style="background-color: #e3f2fd;">X 向來風 (迎風寬 $B_y$)</th>
                            <th colspan="3" style="background-color: #fce4ec;">Y 向來風 (迎風寬 $B_x$)</th>
                        </tr>
                        <tr> <!-- 設定固定高度讓內容對齊 -->
                            <th style="background-color: #e3f2fd; vertical-align: middle;">順風向風力<br>$W_{Dz,X}$<br>(kgf)</th>
                            <th style="background-color: #e3f2fd; vertical-align: middle;">迎風寬<br>$B_y$<br>(m)</th>
                            <th style="background-color: #bbdefb; vertical-align: middle;">扭矩<br>$M_{Tz,X}$<br>(kgf-m)</th>
                            <th style="background-color: #fce4ec; vertical-align: middle;">順風向風力<br>$W_{Dz,Y}$<br>(kgf)</th>
                            <th style="background-color: #fce4ec; vertical-align: middle;">迎風寬<br>$B_x$<br>(m)</th>
                            <th style="background-color: #f8bbd0; vertical-align: middle;">扭矩<br>$M_{Tz,Y}$<br>(kgf-m)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in chapter_9_data.table_rows %}
                        <tr>
                            <td>{{ row.elevation }}</td>
                            <td>{{ row.z|floatformat:2 }}</td>

                            <!-- X 風向數據 -->
                            <td>{{ row.w_dz_x|floatformat:0 }}</td>
                            <td>{{ row.width_x|floatformat:2 }}</td>
                            <td style="font-weight: bold; color: #1565c0;">{{ row.m_tz_x|floatformat:0 }}</td>

                            <!-- Y 風向數據 -->
                            <td>{{ row.w_dz_y|floatformat:0 }}</td>
                            <td>{{ row.width_y|floatformat:2 }}</td>
                            <td style="font-weight: bold; color: #c2185b;">{{ row.m_tz_y|floatformat:0 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- 結論區塊 -->
               <div class="summary-box" style="margin-top: 20px; border-left: 5px solid #ff9800; background-color: #fff3e0;">
                    <p><strong>結論：</strong></p>
                    <p>
                        經檢核各樓層扭矩計算結果，本案設計扭矩主要由
                        <span style="font-weight: bold; color: #d84315; font-size: 1.1em;">{{ chapter_9_data.overall_control }} 向來風</span> 控制。
                    </p>
                </div>

            {% endif %}
        </div>
    </div>
    <div class="page-number">第 10 頁</div>
</div>