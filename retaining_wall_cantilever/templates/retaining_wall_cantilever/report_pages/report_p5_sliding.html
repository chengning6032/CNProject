<div class="a4-page">
    <div class="report-header">
        <div class="report-title">4. 抗滑動穩定性檢核詳細計算</div>
        <div class="report-subtitle">Detailed Calculation of Sliding Stability</div>
    </div>

    <div class="content math-content">
        <!-- 4.1 理論公式 -->
        <h5 class="mt-4 border-bottom pb-2">4.1 檢核公式 (Formula)</h5>
        <div class="mb-3">
            <p>抗滑動安全係數 ($FS_{sliding}$) 定義為總抵抗力與總驅動力之比值：</p>
            <div style="overflow-x: auto;">
                $$ FS_{sliding} = \dfrac{F_{resist}}{F_{driving}} = \dfrac{F_{friction} + P_{passive}}{F_{driving}} \ge
                1.5 \text{ (Static)} $$
            </div>
            <p class="text-muted small">其中：<br>
                $F_{friction} = N \cdot \tan(\delta_b) + c_a \cdot B$ (基底摩擦阻力)<br>
                $P_{passive}$ = 牆前及止滑榫提供之被動土壓力</p>
        </div>

        <!-- 4.2 垂直力計算 -->
        <h5 class="mt-4 border-bottom pb-2">4.2 總垂直正向力計算 ($N$)</h5>
        <div class="mb-3">
            <p>包含結構自重 ($W$) 與土壓力垂直分量 ($P_v$)：</p>
            <div style="overflow-x: auto;">
                $$
                \begin{aligned}
                N &= \sum W + \sum P_v \\
                &= {{ sliding_details.N_weight }} + {{ sliding_details.N_soil_v }} \\
                &= \mathbf{ {{ sliding_details.N_total }} } \text{ tf/m}
                \end{aligned}
                $$
            </div>
        </div>

        <!-- 4.3 摩擦阻力計算 -->
        <h5 class="mt-4 border-bottom pb-2">4.3 基底摩擦阻力計算 ($F_{friction}$)</h5>
        <div class="mb-3">
            <p>參數：$\phi_b = {{ input_data.phi_soil_base }}^\circ \Rightarrow \delta_b = 2/3 \phi_b
                = {{ sliding_details.delta_base|floatformat:1 }}^\circ, \quad c_a = {{ sliding_details.c_base }} \text{
                tf/m}^2, \quad B = {{ sliding_details.B_total }} \text{ m}$</p>
            <div style="overflow-x: auto;">
                $$
                \begin{aligned}
                F_{friction} &= N \cdot \tan(\delta_b) + c_a \cdot B \\
                &= {{ sliding_details.N_total }} \cdot \tan({{ sliding_details.delta_base|floatformat:1 }}^\circ)
                + {{ sliding_details.c_base }} \cdot {{ sliding_details.B_total }} \\
                &= {{ sliding_details.N_total }} \cdot {{ sliding_details.tan_delta }}
                + {{ sliding_details.F_friction_C }} \\
                &= \mathbf{ {{ sliding_details.F_friction_total }} } \text{ tf/m}
                \end{aligned}
                $$
            </div>
        </div>

        <!-- 4.4 被動阻力與結果 -->
        <h5 class="mt-4 border-bottom pb-2">4.4 總抵抗力與安全係數 ($FS$)</h5>
        <div class="mb-3">
            <p>
                <strong>被動土壓力 ($P_{passive}$):</strong>
                採用
                {% if sliding_details.is_seismic %}
                    <span class="text-danger fw-bold">動態 (Dynamic $P_{pe}$)</span>
                {% else %}
                    <span class="text-primary fw-bold">靜態 (Static $P_p$)</span>
                {% endif %}
                計算結果。
            </p>
            <div style="overflow-x: auto;">
                $$
                \begin{aligned}
                F_{resist} &= F_{friction} + P_{passive} \\
                &= {{ sliding_details.F_friction_total }} + {{ sliding_details.P_passive }} \\
                &= \mathbf{ {{ sliding_details.F_resist_total }} } \text{ tf/m}
                \end{aligned}
                $$
            </div>

            <p class="mt-3"><strong>總水平驅動力 ($F_{driving}$):</strong></p>
            <div style="overflow-x: auto;">
                $$ F_{driving} = \sum P_H = \mathbf{ {{ sliding_details.F_driving }} } \text{ tf/m} $$
            </div>

            <p class="mt-3"><strong>安全係數計算:</strong></p>
            <div class="alert {% if sliding_details.FS >= 1.5 %}alert-success{% else %}alert-danger{% endif %}">
                $$
                \begin{aligned}
                FS_{sliding} &= \dfrac{ {{ sliding_details.F_resist_total }} }{ {{ sliding_details.F_driving }} }
                \\[1em]
                &= \mathbf{ {{ sliding_details.FS }} }
                \end{aligned}
                $$
            </div>
            <p class="text-end">
                判定：
                {% if sliding_details.FS >= 1.5 %}
                    <span class="badge bg-success fs-6">OK (符合規範 $\ge 1.5$)</span>
                {% else %}
                    <span class="badge bg-danger fs-6">NG (不符規範 $< 1.5$)</span>
                {% endif %}
            </p>
        </div>

    </div>

    <div class="report-footer">
        <div class="d-flex justify-content-between">
            <span>Generated by CNProject StructTool</span>
            <span>Page 5 / 8</span>
        </div>
    </div>
</div>