{% extends "retaining_wall_cantilever/report_base.html" %}

{% block report_content %}

    <!-- Page 1: 總覽 -->
    {% include "retaining_wall_cantilever/report_pages/report_p1_summary.html" %}

    <!-- Page 2: 基本性質 -->
    {% include "retaining_wall_cantilever/report_pages/report_p2_properties.html" %}

    <!-- Page 3: 模型圖 -->
    {% include "retaining_wall_cantilever/report_pages/report_p3_model.html" %}

    <!-- Page 4: 計算過程 -->
    {% include "retaining_wall_cantilever/report_pages/report_p4_calculation.html" %}

    <!-- Page 5~8: 預留頁 (使用 report_p5_rest.html 模板跑迴圈) -->
    {% for i in "5678" %}
        {% include "retaining_wall_cantilever/report_pages/report_p5_rest.html" with page_num=i %}
    {% endfor %}

{% endblock %}

{% block extra_scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 執行 SVG 繪圖 (代碼在 report_p3_model.html 或是這裡定義)
            renderWallSVG();
        });

        function renderWallSVG() {
            // --- 這裡放入您原本完整的 SVG 繪圖 JS 代碼 ---
            // (為了版面整潔，請將之前提供的 renderWallSVG 完整函式貼在這裡)
            // 記得變數要用 parseFloat("{{ input_data.xxx }}") 讀取

            const d = {
                H_stem: parseFloat("{{ input_data.H_stem }}") || 300,
                t_top: parseFloat("{{ input_data.t_stem_top }}") || 30,
                w_front: parseFloat("{{ input_data.w_stem_front }}") || 0,
                w_back: parseFloat("{{ input_data.w_stem_back }}") || 20,
                H_bp: parseFloat("{{ input_data.H_bp }}") || 50,
                L_front: parseFloat("{{ input_data.L_bp_front }}") || 100,
                L_back: parseFloat("{{ input_data.L_bp_back }}") || 200,
                H_sk: parseFloat("{{ input_data.H_sk }}") || 0,
                L_sk: parseFloat("{{ input_data.L_sk }}") || 0,
                x_1: parseFloat("{{ input_data.x_1 }}") || 0,
                H_fill: ("{{ input_data.H_fill }}") ? parseFloat("{{ input_data.H_fill }}") : parseFloat("{{ input_data.H_stem }}"),
                H_water: parseFloat("{{ input_data.H_water }}") || 0,
                alpha: parseFloat("{{ input_data.alpha_soil }}") || 0,
                H_soil_front: parseFloat("{{ input_data.H_soil_front }}") || 50
            };
            // ... (接續完整的繪圖邏輯) ...
            // (請使用您上一版正確的 JS 代碼)

            // 為了確保您有完整代碼，這裡簡述關鍵:
            const t_bot = d.w_front + d.t_top + d.w_back;
            const B_total = d.L_front + t_bot + d.L_back;
            const container = document.getElementById('svg-container');
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");

            // Scale Logic
            let extraHeight = (d.alpha > 0) ? (B_total * 0.8) * Math.tan(d.alpha * Math.PI / 180) : 0;
            const totalW = B_total * 1.6;
            const totalH = Math.max(d.H_bp + d.H_fill + extraHeight, d.H_bp + d.H_stem) + d.H_sk + 50;

            // Fix: getBoundingClientRect might be 0 if hidden, use fixed guess
            const availW = 700;
            const availH = 800;

            const scale = Math.min(availW / totalW, availH / totalH) * 0.8;
            const offX = (availW - totalW * scale) / 2 + 50;
            const offY = (availH - totalH * scale) / 2 + (Math.max(d.H_bp + d.H_fill + extraHeight, d.H_bp + d.H_stem)) * scale + 50;

            function toSVG(x, y) {
                return {x: offX + x * scale, y: offY - y * scale};
            }

            // Helper Functions (createLine, createPolygon, drawDim, createText...)
            // (請務必將這些 helper 函式完整貼回這裡)

            // 1. Structure
            // 2. Backfill
            // 3. Front Soil
            // 4. Water
            // 5. Dims

            // ... 繪圖邏輯結束 ...

            container.appendChild(svg);
        }
    </script>
{% endblock %}