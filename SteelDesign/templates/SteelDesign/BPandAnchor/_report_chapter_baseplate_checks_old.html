{% load unit_conversion_filters %}

<!-- ================== 第三页: 详细計算过程 ================== -->
<div class="a4-page">
    <div class="page-content">
        <div class="chapter-title">第六章、鋼柱基礎版及錨栓設計檢核</div>
        <div class="report-section">
            {% with check_data=results.concrete_bearing %}
                {% if check_data %}
                    {% with check=check_data.details %}
                        <div class="report-subtitle">6.1 混凝土柱墩抗壓強度檢核</div>
                        {% if check.result != 'N/A' %}
                            <p class="check-message" style="margin-bottom: 15px;">
                                <i>* 此檢核採用所有載重组合中產生的最大混凝土壓應力 ($f_{pu}$) 来計算最不利的需求總力
                                    ($B_u$)。</i>
                            </p>
                            {% if check.plot_base64 %}
                                <div style="text-align: center; margin: 15px 0;">
                                    <img src="data:image/png;base64,{{ check.plot_base64|safe }}" alt="應力分布圖"
                                         style="max-width: 80%; max-height: 100mm;">
                                    <figcaption>圖 6.1 控制工況之應力分佈圖</figcaption>
                                </div>
                            {% endif %}
                            {% if unit_system == 'mks' %}
                                <p>控制性荷載組合: <b>#{{ check_data.combo_id }}</b>，最大混凝土壓應力 $f_{pu,max}
                                    = {{ check.f_pu_max_mks|floatformat:"-2" }} \text{ kgf/cm}^2$</p>

                                <p>該組合下之需求承壓總力 (經應力積分): $B_u = {{ check.Bu_mks|floatformat:"-2" }}
                                    \text{ tf}$</p>
                                <p>承載面積 $A_1 = {{ check.A1_mks|floatformat:"-2" }} \text{ cm}^2$</p>
                                <p>支承面有效面積 $A_2 = {{ check.A2_mks|floatformat:"-2" }} \text{ cm}^2$</p>

                                $ \sqrt{\dfrac{A_2}{A_1}} = \sqrt{\dfrac{ {{ check.A2_mks|floatformat:"-2" }} }{
                                {{ check.A1_mks|floatformat:"-2" }} }} = {{ check.confinement_factor|floatformat:"-2" }}
                                \le
                                2.0
                                $

                                <p>標稱承載強度 $B_n = \min(\sqrt{\dfrac{A_2}{A_1}}, 2.0) \times 0.85 \times f'_c \times
                                    A_1$</p>
                                $ B_n = {{ check.confinement_factor|floatformat:"-2" }} \times 0.85 \times
                                {{ check.fc_mks|floatformat:"-2" }} \times {{ check.A1_mks|floatformat:"-2" }} =
                                {{ check.Bn_mks|floatformat:"-2" }} \text{ tf} $

                                <p>設計承載強度 $\phi B_n = \phi_c \times B_n
                                    = {{ check.phi_c|floatformat:"-2" }} \times {{ check.Bn_mks|floatformat:"-2" }} =
                                    {{ check.phi_Bn_mks|floatformat:"-2" }} \text{ tf} $

                                    {% if check.dc_ratio > 1.0 %}
                                        <p>檢核：
                                            $ \dfrac{B_{u,max}}{\phi B_n} = \dfrac{ {{ check.Bu_mks|floatformat:"-2" }}
                                            }{
                                            {{ check.phi_Bn_mks|floatformat:"-2" }} }
                                            = {{ check.dc_ratio|floatformat:"-3" }}
                                            > 1.0
                                            \rightarrow \textbf{ {{ check.result }} } $</p>
                                    {% else %}
                                        <p>檢核：
                                            $ \dfrac{B_{u,max}}{\phi B_n} = \dfrac{ {{ check.Bu_mks|floatformat:"-2" }}
                                            }{
                                            {{ check.phi_Bn_mks|floatformat:"-2" }} }
                                            = {{ check.dc_ratio|floatformat:"-3" }}
                                            \le 1.0
                                            \rightarrow \textbf{ {{ check.result }} } $</p>
                                    {% endif %}

                            {% else %}
                                <p>控制性荷載組合: <b>#{{ check_data.combo_id }}</b>，最大混凝土壓應力 $f_{pu,max}
                                    = {{ check.f_pu_max_ksi|floatformat:"-3" }} \text{ ksi}$</p>


                                <p>該組合下之需求承壓總力 (經應力積分): $B_u = {{ check.Bu|floatformat:"-2" }} \text{
                                    kips}$</p>

                                <p>承載面積 $A_1 = {{ check.A1|floatformat:"-2" }} \text{ in}^2$</p>
                                <p>支承面有效面積 $A_2 = {{ check.A2|floatformat:"-2" }} \text{ in}^2$</p>

                                $ \sqrt{\dfrac{A_2}{A_1}} = \sqrt{\dfrac{ {{ check.A2|floatformat:"-2" }} }{
                                {{ check.A1|floatformat:"-2" }} }} = {{ check.confinement_factor|floatformat:"-2" }} \le
                                2.0
                                $

                                <p>標稱承載強度 $B_n = \min(\sqrt{\dfrac{A_2}{A_1}}, 2.0) \times 0.85 \times f'_c \times
                                    A_1$</p>
                                $ B_n = {{ check.confinement_factor|floatformat:"-2" }} \times 0.85 \times
                                {{ check.fc_ksi|floatformat:"-2" }} \times {{ check.A1|floatformat:"-2" }} =
                                {{ check.Bn|floatformat:"-2" }} \text{ kips} $

                                <p>設計承載強度 $\phi B_n = \phi_c \times B_n
                                    = {{ check.phi_c|floatformat:"-2" }} \times {{ check.Bn|floatformat:"-2" }} =
                                    {{ check.phi_Bn|floatformat:"-2" }} \text{ kips} $

                                    {% if check.dc_ratio > 1.0 %}
                                        <p>檢核：
                                            $ \dfrac{B_{u,max}}{\phi B_n} = \dfrac{ {{ check.Bu|floatformat:"-2" }} }{
                                            {{ check.phi_Bn|floatformat:"-2" }} }
                                            = {{ check.dc_ratio|floatformat:"-3" }}
                                            > 1.0
                                            \rightarrow \textbf{ {{ check.result }} } $</p>
                                    {% else %}
                                        <p>檢核：
                                            $ \dfrac{B_{u,max}}{\phi B_n} = \dfrac{ {{ check.Bu|floatformat:"-2" }} }{
                                            {{ check.phi_Bn|floatformat:"-2" }} }
                                            = {{ check.dc_ratio|floatformat:"-3" }}
                                            \le 1.0
                                            \rightarrow \textbf{ {{ check.result }} } $</p>
                                    {% endif %}
                            {% endif %}
                        {% else %}
                            <p class="check-message" style="font-size: 16px; line-height: 1.8; font-style: normal;">
                                混凝土墩柱未受到壓應力作用，故不予檢核。
                            </p>
                        {% endif %}


                    {% endwith %}


                {% endif %}
            {% endwith %}
        </div>
    </div>
</div>


{% with check_data=results.plate_bending %}
    {% if check_data and check_data.details.result != 'N/A' %}
        <!-- 6.2 第一頁 -->
        <div class="a4-page">
            <div class="page-content">
                <div class="chapter-title">第六章、鋼柱基礎版及錨栓設計檢核 (續)</div>
                <div class="report-section">
                    {% with check=check_data.details %}
                        <div class="report-subtitle">6.2 柱基板臨界斷面抗彎強度檢核</div>
                        <p>此檢核由荷載組合 <b>#{{ check_data.combo_id }}</b> 控制。</p>

                        {% if check.plot_base64 %}
                            <div style="text-align: center; margin: 15px 0;">
                                <!-- [核心修正] 新增 max-height 屬性 -->
                                <img src="data:image/png;base64,{{ check.plot_base64|safe }}"
                                     alt="基礎版彎曲強度示意圖"
                                     style="max-width: 60%; max-height: 100mm; border: 1px solid #ccc;">
                                <figcaption>圖 6.2 基礎版彎曲強度示意圖</figcaption>
                            </div>
                        {% endif %}
                        <br>
                        <br>
                        <p><b>臨界斷面位置計算 (AISC Design Guide 1):</b></p>
                        {% with col=check.col_params plate=check.plate_params %}
                            {% if unit_system == 'mks' %}
                                <!-- MKS 單位顯示 -->
                                {% if col.type|lower == 'h-shape' %}
                                    <p style="margin-left: 15px;">m-m 斷面距中心: $0.8 \times b_f / 2 = 0.8
                                        \times {{ col.bf|to_cm:2 }} / 2 = {{ check.m_crit_dist|to_cm:2 }} \text{
                                        cm}$</p>
                                    <p style="margin-left: 15px;">n-n 斷面距中心: $0.95 \times d / 2 = 0.95
                                        \times {{ col.d|to_cm:2 }} / 2 = {{ check.n_crit_dist|to_cm:2 }} \text{
                                        cm}$</p>
                                {% elif col.type|lower == 'tube' %}
                                    <p style="margin-left: 15px;">m-m 斷面距中心: $0.95 \times B_{tube} / 2 = 0.95
                                        \times {{ col.B|to_cm:2 }} / 2 = {{ check.m_crit_dist|to_cm:2 }} \text{
                                        cm}$</p>
                                    <p style="margin-left: 15px;">n-n 斷面距中心: $0.95 \times H_{tube} / 2 = 0.95
                                        \times {{ col.H|to_cm:2 }} / 2 = {{ check.n_crit_dist|to_cm:2 }} \text{
                                        cm}$</p>
                                {% elif col.type|lower == 'pipe' %}
                                    <p style="margin-left: 15px;">m-m & n-n 斷面距中心: $0.8 \times D_{pipe} / 2 =
                                        0.8 \times {{ col.D|to_cm:2 }} / 2 = {{ check.m_crit_dist|to_cm:2 }} \text{
                                        cm}$</p>
                                {% endif %}

                                {% if plate.shape == 'rectangle' %}
                                    <p style="margin-left: 15px;">m-m 懸臂長度: $m = B/2 - (\text{m-m 距中心})
                                        = {{ plate.B|to_cm:2 }}/2 - {{ check.m_crit_dist|to_cm:2 }}
                                        = {{ check.m_geom|to_cm:2 }} \text{ cm}$</p>
                                    <p style="margin-left: 15px;">n-n 懸臂長度: $n = N/2 - (\text{n-n 距中心})
                                        = {{ plate.N|to_cm:2 }}/2 - {{ check.n_crit_dist|to_cm:2 }}
                                        = {{ check.n_geom|to_cm:2 }} \text{ cm}$</p>
                                {% elif plate.shape == 'circle' %}
                                    <p style="margin-left: 15px;">m-m 懸臂長度: $m = R - (\text{m-m 距中心})
                                        = {{ check.radius|to_cm:2 }} - {{ check.m_crit_dist|to_cm:2 }}
                                        = {{ check.m_geom|to_cm:2 }} \text{ cm}$</p>
                                    <p style="margin-left: 15px;">n-n 懸臂長度: $n = R - (\text{n-n 距中心})
                                        = {{ check.radius|to_cm:2 }} - {{ check.n_crit_dist|to_cm:2 }}
                                        = {{ check.n_geom|to_cm:2 }} \text{ cm}$</p>
                                {% elif plate.shape == 'octagon' %}
                                    <p style="margin-left: 15px;">八邊形邊心距 (Apothem): $A_p
                                        = {{ check.apothem|to_cm:2 }} \text{ cm}$</p>
                                    <p style="margin-left: 15px;">m-m 懸臂長度: $m = A_p - (\text{m-m 距中心})
                                        = {{ check.apothem|to_cm:2 }} - {{ check.m_crit_dist|to_cm:2 }}
                                        = {{ check.m_geom|to_cm:2 }} \text{ cm}$</p>
                                    <p style="margin-left: 15px;">n-n 懸臂長度: $n = A_p - (\text{n-n 距中心})
                                        = {{ check.apothem|to_cm:2 }} - {{ check.n_crit_dist|to_cm:2 }}
                                        = {{ check.n_geom|to_cm:2 }} \text{ cm}$</p>
                                {% endif %}
                            {% else %}
                                <!-- Imperial 單位顯示 -->
                                {% if col.type|lower == 'h-shape' %}
                                    <p style="margin-left: 15px;">m-m 斷面距中心: $0.8 \times b_f / 2 = 0.8
                                        \times {{ col.bf|floatformat:"-2" }} / 2
                                        = {{ check.m_crit_dist|floatformat:"-3" }} \text{ in}$</p>
                                    <p style="margin-left: 15px;">n-n 斷面距中心: $0.95 \times d / 2 = 0.95
                                        \times {{ col.d|floatformat:"-2" }} / 2
                                        = {{ check.n_crit_dist|floatformat:"-3" }} \text{ in}$</p>
                                {% elif col.type|lower == 'tube' %}
                                    <p style="margin-left: 15px;">m-m 斷面距中心: $0.95 \times B_{tube} / 2 = 0.95
                                        \times {{ col.B|floatformat:"-2" }} / 2
                                        = {{ check.m_crit_dist|floatformat:"-3" }} \text{ in}$</p>
                                    <p style="margin-left: 15px;">n-n 斷面距中心: $0.95 \times H_{tube} / 2 = 0.95
                                        \times {{ col.H|floatformat:"-2" }} / 2
                                        = {{ check.n_crit_dist|floatformat:"-3" }} \text{ in}$</p>
                                {% elif col.type|lower == 'pipe' %}
                                    <p style="margin-left: 15px;">m-m & n-n 斷面距中心: $0.8 \times D_{pipe} / 2 =
                                        0.8 \times {{ col.D|floatformat:"-2" }} / 2
                                        = {{ check.m_crit_dist|floatformat:"-3" }} \text{ in}$</p>
                                {% endif %}

                                {% if plate.shape == 'rectangle' %}
                                    <p style="margin-left: 15px;">m-m 懸臂長度: $m = B/2 - (\text{m-m 距中心})
                                        = {{ plate.B|floatformat:"-2" }}/2
                                        - {{ check.m_crit_dist|floatformat:"-3" }}
                                        = {{ check.m_geom|floatformat:"-3" }} \text{ in}$</p>
                                    <p style="margin-left: 15px;">n-n 懸臂長度: $n = N/2 - (\text{n-n 距中心})
                                        = {{ plate.N|floatformat:"-2" }}/2
                                        - {{ check.n_crit_dist|floatformat:"-3" }}
                                        = {{ check.n_geom|floatformat:"-3" }} \text{ in}$</p>
                                {% elif plate.shape == 'circle' %}
                                    <p style="margin-left: 15px;">m-m 懸臂長度: $m = R - (\text{m-m 距中心})
                                        = {{ check.radius|floatformat:"-2" }}
                                        - {{ check.m_crit_dist|floatformat:"-3" }}
                                        = {{ check.m_geom|floatformat:"-3" }} \text{ in}$</p>
                                    <p style="margin-left: 15px;">n-n 懸臂長度: $n = R - (\text{n-n 距中心})
                                        = {{ check.radius|floatformat:"-2" }}
                                        - {{ check.n_crit_dist|floatformat:"-3" }}
                                        = {{ check.n_geom|floatformat:"-3" }} \text{ in}$</p>
                                {% elif plate.shape == 'octagon' %}
                                    <p style="margin-left: 15px;">八邊形邊心距 (Apothem): $A_p
                                        = {{ check.apothem|floatformat:"-3" }} \text{ in}$</p>
                                    <p style="margin-left: 15px;">m-m 懸臂長度: $m = A_p - (\text{m-m 距中心})
                                        = {{ check.apothem|floatformat:"-3" }}
                                        - {{ check.m_crit_dist|floatformat:"-3" }}
                                        = {{ check.m_geom|floatformat:"-3" }} \text{ in}$</p>
                                    <p style="margin-left: 15px;">n-n 懸臂長度: $n = A_p - (\text{n-n 距中心})
                                        = {{ check.apothem|floatformat:"-3" }}
                                        - {{ check.n_crit_dist|floatformat:"-3" }}
                                        = {{ check.n_geom|floatformat:"-3" }} \text{ in}$</p>
                                {% endif %}
                            {% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
            </div>
        </div>

        <!-- 6.2 第二頁 (如果需要) -->
        {% with check=check_data.details %}
            {% if check.lambda_info.status == 'Calculated' %}
                <div class="a4-page">
                    <div class="page-content">
                        <div class="chapter-title">第六章、鋼柱基礎版及錨栓設計檢核 (續)</div>
                        <div class="report-section">
                            <div class="report-subtitle">6.2 柱基板臨界斷面抗彎強度檢核 (續)</div>

                            {% with lambda=check.lambda_info col=check.col_params %}
                                {% if lambda.status == 'Calculated' %}
                                    <p style="margin-top: 15px;"><b>λ 係數計算 (因 H 型鋼全斷面受壓啟用):</b></p>

                                    {% if unit_system == 'mks' %}
                                        <p style="margin-left: 15px;">$ X = \left( \dfrac{4 d b_f}{(d+b_f)^2} \right)
                                            \left( \dfrac{P_u}{\phi_c P_p} \right) = {{ lambda.X|floatformat:"-3" }}
                                            $</p>
                                        <p style="margin-left: 15px;">$ \lambda = \dfrac{2 \sqrt{X}}{1+\sqrt{1-X}}
                                            = {{ lambda.lambda|floatformat:"-3" }} \le 1.0 $</p>
                                        <p style="margin-left: 15px;">$ n' = \dfrac{\sqrt{d b_f}}{4} =
                                            \dfrac{\sqrt{ {{ col.d|to_cm:2 }} \times {{ col.bf|to_cm:2 }} }}{4}
                                            = {{ lambda.n_prime|to_cm:2 }} \text{ cm}$
                                            ({{ lambda.n_prime|floatformat:"-3" }} in)</p>
                                        <p style="margin-left: 15px;">考慮柱身變形之等效懸臂長度 $l_{\lambda} = \lambda
                                            n' = {{ lambda.l_lambda|to_cm:2 }} \text{ cm}$
                                            ({{ lambda.l_lambda|floatformat:"-3" }} in)</p>

                                        <!-- [核心新增] MKS 制下的最終懸臂長度判定 -->
                                        <p style="margin-top: 15px;"><b>最終懸臂長度判定:</b></p>
                                        <div style="padding-left: 15px;">
                                            <p>X方向 (m-m 斷面): $l_{eff,m} = \max(m, l_{\lambda}) =
                                                \max({{ lambda.m_geom|to_cm:2 }}, {{ lambda.l_lambda|to_cm:2 }}) =
                                                {% if lambda.m_geom > lambda.l_lambda %}
                                                    {{ lambda.m_geom|to_cm:2 }}{% else %}
                                                    {{ lambda.l_lambda|to_cm:2 }}{% endif %} \text{ cm}$</p>
                                            <p>Y方向 (n-n 斷面): $l_{eff,n} = \max(n, l_{\lambda}) =
                                                \max({{ lambda.n_geom|to_cm:2 }}, {{ lambda.l_lambda|to_cm:2 }}) =
                                                {% if lambda.n_geom > lambda.l_lambda %}
                                                    {{ lambda.n_geom|to_cm:2 }}{% else %}
                                                    {{ lambda.l_lambda|to_cm:2 }}{% endif %} \text{ cm}$</p>
                                        </div>

                                    {% else %} <!-- Imperial -->
                                        <p style="margin-left: 15px;">$ X = \left( \dfrac{4 d b_f}{(d+b_f)^2} \right)
                                            \left( \dfrac{P_u}{\phi_c P_p} \right) = \left( \dfrac{4
                                            \times {{ col.d|floatformat:"-2" }}
                                            \times {{ col.bf|floatformat:"-2" }}}{({{ col.d|floatformat:"-2" }}+{{ col.bf|floatformat:"-2" }})^2}
                                            \right) \times \left( \dfrac{ {{ lambda.Pu_calc|floatformat:"-2" }}
                                            }{ {{ lambda.phi_c_calc|floatformat:"-2" }}
                                            \times {{ lambda.Pp_calc|floatformat:"-2" }} } \right)
                                            = {{ lambda.X|floatformat:"-3" }} $</p>
                                        <p style="margin-left: 15px;">$ \lambda = \dfrac{2 \sqrt{X}}{1+\sqrt{1-X}} =
                                            \dfrac{2 \sqrt{ {{ lambda.X|floatformat:"-3" }}
                                            }}{1+\sqrt{1- {{ lambda.X|floatformat:"-3" }} }}
                                            = {{ lambda.lambda|floatformat:"-3" }} \le 1.0 $</p>
                                        <p style="margin-left: 15px;">$ n' = \dfrac{\sqrt{d b_f}}{4} =
                                            \dfrac{\sqrt{ {{ col.d|floatformat:"-2" }}
                                            \times {{ col.bf|floatformat:"-2" }} }}{4}
                                            = {{ lambda.n_prime|floatformat:"-3" }} \text{ in} $</p>
                                        <p style="margin-left: 15px;">考慮柱身變形之等效懸臂長度 $l_{\lambda} = \lambda
                                            n' = {{ lambda.lambda|floatformat:"-3" }}
                                            \times {{ lambda.n_prime|floatformat:"-3" }}
                                            = {{ lambda.l_lambda|floatformat:"-3" }} \text{ in}$</p>

                                        <!-- [核心新增] Imperial 制下的最終懸臂長度判定 -->
                                        <p style="margin-top: 15px;"><b>最終懸臂長度判定:</b></p>
                                        <div style="padding-left: 15px;">
                                            <p>X方向 (m-m 斷面): $l_{eff,m} = \max(m, l_{\lambda}) =
                                                \max({{ lambda.m_geom|floatformat:"-3" }}, {{ lambda.l_lambda|floatformat:"-3" }})
                                                = {% if lambda.m_geom > lambda.l_lambda %}
                                                    {{ lambda.m_geom|floatformat:"-3" }}{% else %}
                                                    {{ lambda.l_lambda|floatformat:"-3" }}{% endif %} \text{ in}$</p>
                                            <p>Y方向 (n-n 斷面): $l_{eff,n} = \max(n, l_{\lambda}) =
                                                \max({{ lambda.n_geom|floatformat:"-3" }}, {{ lambda.l_lambda|floatformat:"-3" }})
                                                = {% if lambda.n_geom > lambda.l_lambda %}
                                                    {{ lambda.n_geom|floatformat:"-3" }}{% else %}
                                                    {{ lambda.l_lambda|floatformat:"-3" }}{% endif %} \text{ in}$</p>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            {% endwith %}

                            <p style="margin-top: 15px;"><b>各懸臂斷面之需求彎矩 $M_u$ 計算:</b></p>
                            <table class="summary-table" style="font-size: 12px; text-align: right;">
                                <thead>
                                <tr>
                                    <th style="text-align: left;">懸臂位置</th>
                                    {% if unit_system == 'mks' %}
                                        <th>總彎矩 (tf-m)</th>
                                        <th>斷面寬度 (cm)</th>
                                        <th>單位寬度彎矩 (tf-m/m)</th>
                                    {% else %}
                                        <th>總彎矩 (kip-in)</th>
                                        <th>斷面寬度 (in)</th>
                                        <th>單位寬度彎矩 (kip-in/in)</th>
                                    {% endif %}
                                    <th>計算方法</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for item in check.cantilever_calcs %}
                                    <tr {% if item.mu_per_inch == check.max_Mu %}class="critical-row"{% endif %}>
                                        <td style="text-align: left;">{{ item.name }}</td>
                                        {% if unit_system == 'mks' %}
                                            <td><b>{{ item.total_moment|to_tf_m:3 }}</b></td>
                                            <td>{{ item.width|to_cm:2 }}</td>
                                            <td><b>{{ item.mu_per_inch|to_tf_m_per_m:3 }}</b></td>
                                        {% else %}
                                            <td><b>{{ item.total_moment|floatformat:"-2" }}</b></td>
                                            <td>{{ item.width|floatformat:"-2" }}</td>
                                            <td><b>{{ item.mu_per_inch|floatformat:"-3" }}</b></td>
                                        {% endif %}
                                        <td style="font-size: 10px; font-style: italic;">{{ item.calc_method }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>

                            {% if unit_system == 'mks' %}
                                <p>最大需求彎矩 $M_{u,max} = {{ check.max_Mu|to_tf_m_per_m:3 }} \text{ tf-m/m}$</p>
                                <p style="margin-top: 15px;">設計抗彎強度 $\phi M_n = \phi_b \times (F_y \times
                                    \dfrac{t_p^2}{4}) = {{ check.phi_b|floatformat:"-2" }} \times
                                    ({{ check.Fy|floatformat:"-1" }} \times
                                    \dfrac{ {{ check.tp|floatformat:"-2" }}^2 }{4}) /1000
                                    = {{ check.phi_Mn|to_tf_m_per_m:3 }} \text{ tf-m/m}$</p>
                                <p>檢核： $ \dfrac{M_{u,max}}{\phi M_n} = \dfrac{ {{ check.max_Mu|to_tf_m_per_m:3 }}
                                    }{ {{ check.phi_Mn|to_tf_m_per_m:3 }} } = {{ check.dc_ratio|floatformat:"-3" }} \le
                                    1.0 \rightarrow \textbf{ {{ check.result }} } $</p>
                            {% else %}
                                <p>最大需求彎矩 $M_{u,max} = {{ check.max_Mu|floatformat:"-3" }} \text{ kip-in/in}$</p>
                                <p style="margin-top: 15px;">設計抗彎強度 $\phi M_n = \phi_b \times (F_y \times
                                    \dfrac{t_p^2}{4}) = {{ check.phi_b|floatformat:"-2" }} \times
                                    ({{ check.Fy|floatformat:"-1" }} \times
                                    \dfrac{ {{ check.tp|floatformat:"-2" }}^2 }{4})
                                    = {{ check.phi_Mn|floatformat:"-3" }} \text{ kip-in/in}$</p>
                                <p>檢核： $ \dfrac{M_{u,max}}{\phi M_n} = \dfrac{ {{ check.max_Mu|floatformat:"-3" }}
                                    }{ {{ check.phi_Mn|floatformat:"-3" }} } = {{ check.dc_ratio|floatformat:"-3" }} \le
                                    1.0 \rightarrow \textbf{ {{ check.result }} } $</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endwith %}

{#    {% elif results.has_any_tension == False and results.has_any_shear == False %}#}
        {% else %}
        {# 只有在純壓力下(無拉無剪)，才顯示這個提示 #}
        <div class="a4-page">
            <div class="page-content">
                <div class="chapter-title">第六章、鋼柱基礎版及錨栓設計檢核 (續)</div>
                <div class="report-section">
                    <div class="report-subtitle">6.2 柱基板臨界斷面抗彎強度檢核</div>
                    <p class="check-message" style="font-size: 16px; line-height: 1.8; font-style: normal;">
                        基礎版未受到彎曲應力作用，故基礎版彎曲強度足夠，但基礎板厚度仍需依據規範規定。
                    </p>
                </div>
            </div>
        </div>
    {% endif %}
{% endwith %}
